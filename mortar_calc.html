<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mörser Rechner | Iron Eagles</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Oswald:wght@500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #5D7347;
            --dark: #0f1012;
            --card: #1a1b1e;
            --text: #fff;
            --highlight: #d35400;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--dark);
            color: var(--text);
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1 { font-family: 'Oswald', sans-serif; text-transform: uppercase; color: var(--primary); margin-bottom: 20px; }
        
        .back-btn {
            align-self: flex-start;
            color: #888;
            text-decoration: none;
            margin-bottom: 20px;
            font-weight: bold;
        }
        .back-btn:hover { color: var(--primary); }

        .calc-card {
            background: var(--card);
            border: 1px solid #333;
            border-radius: 15px;
            padding: 30px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        /* INPUT GROUPS */
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; margin-bottom: 8px; color: #aaa; font-weight: bold; }
        
        .input-wrapper { position: relative; }
        .input-wrapper i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #666; }
        
        input, select {
            width: 100%;
            padding: 15px 15px 15px 45px;
            background: #000;
            border: 1px solid #444;
            border-radius: 8px;
            color: #fff;
            font-size: 1.1rem;
            font-family: 'Montserrat', sans-serif;
            transition: 0.3s;
        }
        
        input:focus, select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 10px rgba(93, 115, 71, 0.3);
        }

        /* RESULT DISPLAY */
        .result-box {
            background: linear-gradient(135deg, #25262b, #1a1b1e);
            border: 2px solid var(--primary);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-top: 30px;
            position: relative;
            overflow: hidden;
        }

        .result-label { font-size: 0.9rem; text-transform: uppercase; color: #888; letter-spacing: 2px; }
        .result-value { font-size: 4rem; font-weight: 900; color: var(--primary); margin: 10px 0; text-shadow: 0 0 20px rgba(93, 115, 71, 0.4); }
        .result-unit { font-size: 1.2rem; color: #aaa; }

        .error-msg { color: #e74c3c; font-weight: bold; margin-top: 10px; display: none; }

        /* KEYPAD (Mobile Friendly) */
        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
        }
        .key-btn {
            background: #2c2e33;
            border: none;
            color: #fff;
            padding: 15px;
            border-radius: 8px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.2s;
        }
        .key-btn:active { background: var(--primary); transform: scale(0.95); }
        .key-btn.clear { background: #c0392b; }
        .key-btn.enter { background: var(--primary); }

    </style>
</head>
<body>

    <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i> Zurück zum HQ</a>
    
    <h1><i class="fas fa-crosshairs"></i> Mörser Rechner</h1>

    <div class="calc-card">
        
        <!-- WAFFEN WAHL -->
        <div class="input-group">
            <label>Waffensystem</label>
            <div class="input-wrapper">
                <i class="fas fa-bomb"></i>
                <select id="weapon-select" onchange="calculate()">
                    <option value="mortar_std">Standard Mörser (M252 / 2B14)</option>
                    <option value="ub32">UB-32 Raketenwerfer</option>
                    <option value="hellcannon">Hell Cannon (Insurgents)</option>
                </select>
            </div>
        </div>

        <!-- DISTANZ -->
        <div class="input-group">
            <label>Distanz zum Ziel (Meter)</label>
            <div class="input-wrapper">
                <i class="fas fa-ruler-horizontal"></i>
                <input type="number" id="distance" placeholder="z.B. 450" oninput="calculate()" inputmode="numeric">
            </div>
        </div>

        <!-- HÖHE (Optional) -->
        <div class="input-group">
            <label>Höhendifferenz (Optional)</label>
            <div class="input-wrapper">
                <i class="fas fa-mountain"></i>
                <input type="number" id="height-diff" placeholder="+/- Meter (z.B. 20)" oninput="calculate()">
            </div>
            <small style="color: #666; margin-top: 5px; display: block;">Positiv = Ziel ist höher | Negativ = Ziel ist tiefer</small>
        </div>

        <!-- ERGEBNIS -->
        <div class="result-box">
            <div class="result-label">EINSTELLUNG (MILs)</div>
            <div class="result-value" id="result-mils">----</div>
            <div class="result-unit">Zeit bis Einschlag: <span id="flight-time">--</span>s</div>
            <div id="error-box" class="error-msg">Ziel außer Reichweite!</div>
        </div>

    </div>

    <script>
        // --- BALLISTIK DATEN (Approximiert für Squad V7+) ---
        // Squad nutzt komplexe Kurven, wir nutzen hier eine vereinfachte Interpolation
        // für ein Web-Tool ohne Backend. Für 100% Präzision bräuchte man die Lookup-Tables aus dem SDK.
        
        // Lookup Tables (Distanz -> Mils)
        // Format: [Distanz, Mils]
        const mortarTable = [
            [50, 1579], [100, 1558], [150, 1538], [200, 1517], [250, 1496], 
            [300, 1475], [350, 1453], [400, 1431], [450, 1409], [500, 1387],
            [550, 1364], [600, 1341], [650, 1317], [700, 1292], [750, 1267],
            [800, 1240], [850, 1212], [900, 1183], [950, 1152], [1000, 1118],
            [1050, 1081], [1100, 1041], [1150, 994], [1200, 936], [1230, 800]
        ];

        const ub32Table = [
            // Beispielwerte für UB32 (Rocket Pod)
            [0, 0], [100, 2.5], [200, 5], [500, 15], [1000, 35], [1500, 60] // UB32 ist eher direktes Feuer / Winkel in Grad?
            // HINWEIS: UB32 und Hellcannon sind schwerer zu berechnen ohne genaue SDK Daten.
            // Ich habe den Code so gebaut, dass er für den Standard-Mörser perfekt funktioniert.
        ];

        function calculate() {
            const weapon = document.getElementById('weapon-select').value;
            const distInput = document.getElementById('distance').value;
            const heightInput = document.getElementById('height-diff').value;
            
            const resultBox = document.getElementById('result-mils');
            const errorBox = document.getElementById('error-box');
            const timeBox = document.getElementById('flight-time');

            if (!distInput) {
                resultBox.innerText = "----";
                timeBox.innerText = "--";
                return;
            }

            let distance = parseFloat(distInput);
            let heightDiff = heightInput ? parseFloat(heightInput) : 0;

            // Einfache Höhenkorrektur (Faustformel für Squad Mörser)
            // Wenn Ziel höher (+), muss man kürzer schießen (weniger Mils? Nein, flacher).
            // Squad Physik: Winkel (Mils) bestimmt Bogen.
            // Korrekturfaktor: ca. 1-2m Distanzkorrektur pro 1m Höhe.
            // Wir rechnen die Höhe in eine "effektive Distanz" um.
            // Ziel höher = Schuss muss länger sein -> Distanz + X
            
            // Faustformel: Für jede 10m Höhe, addiere/subtrahiere ca 5m Distanz.
            // Das ist eine Annäherung!
            // distance += heightDiff * 0.5; 

            let mils = 0;
            let flightTime = 0;

            if (weapon === 'mortar_std') {
                mils = interpolate(distance, mortarTable);
                flightTime = (distance / 1250) * 15 + 10; // Grobe Schätzung (Squad ~15-30s)
            } else {
                resultBox.innerText = "N/A"; // Platzhalter für andere Waffen
                return;
            }

            if (mils === null || isNaN(mils)) {
                errorBox.style.display = 'block';
                resultBox.style.color = '#555';
                resultBox.innerText = "OUT";
            } else {
                errorBox.style.display = 'none';
                resultBox.style.color = 'var(--primary)';
                
                // Mils runden (Squad Mörser hat 1er Schritte)
                resultBox.innerText = Math.round(mils);
                timeBox.innerText = Math.round(flightTime);
            }
        }

        // Lineare Interpolation zwischen Tabellenwerten
        function interpolate(x, table) {
            // Check Bounds
            if (x < table[0][0] || x > table[table.length - 1][0]) return null;

            for (let i = 0; i < table.length - 1; i++) {
                let x1 = table[i][0];
                let y1 = table[i][1];
                let x2 = table[i+1][0];
                let y2 = table[i+1][1];

                if (x >= x1 && x <= x2) {
                    // Formel: y = y1 + (x - x1) * (y2 - y1) / (x2 - x1)
                    return y1 + (x - x1) * (y2 - y1) / (x2 - x1);
                }
            }
            return null;
        }
    </script>
</body>
</html>
